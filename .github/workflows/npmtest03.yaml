###############################################################
#
## Copyright (©) 2024-2025 David H Hoyt. All rights reserved.
##                 https://srd.cx
##
## Last Updated: 23-MAY-2025 at 0700 EDT by David Hoyt (©)
#
## Intent: npm smoke test
#
##

#
#
###############################################################

name: "npm install iccdev"
on:
  workflow_dispatch:

jobs:
  iccdev-test:
    name: "Install & Verify iccdev"
    runs-on: macos-14

    steps:
      - name: Log Node & System Info
        run: |
          echo "Node: $(node -v)"
          echo "NPM: $(npm -v)"
          echo "User: $(whoami)"
          echo "Platform: $(uname -a)"
          echo "Working Dir: $(pwd)"

      - name: Init test directory
        run: |
          mkdir iccdev-test && cd iccdev-test
          npm init -y

      - name: Install iccdev
        working-directory: ./iccdev-test
        run: npm install iccdev

      - name: List installed files
        working-directory: ./iccdev-test
        run: ls -R node_modules/iccdev || echo "Install missing or failed"

      - name: Show installed scripts or JS
        working-directory: ./iccdev-test/node_modules/iccdev
        run: |
          echo "Top-level files:"
          ls -lh
          echo "All WASM & JS:"
          find . -type f \( -name "*.js" -o -name "*.wasm" \)

      - name: Dump package metadata
        working-directory: ./iccdev-test
        run: cat package.json
